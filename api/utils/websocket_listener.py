# Example topics
# {
#   topics: [
#     '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef',
#     [
#       '0x00000000000000000000000018ccc241cce98a67564e367ebc1f1f0e692e3188',
#       '0x0000000000000000000000001ccb2945f1325e061b40fe5b0b452f0e76fb7278',
#       '0x000000000000000000000000264bf51639f5753f05d65e4637ad22078f1652ca',
#       '0x0000000000000000000000002eff303377b9e01e042b7f80fb42836b35fb1a49',
#       '0x000000000000000000000000348ee4ed9363299832c33dbb1b52c7fbd5571754',
#       '0x00000000000000000000000039e856863e5f6f0654a0b87b12bc921da23d06bb',
#       '0x0000000000000000000000004e84e4b6ed03c95def00d43e13ff1e8f4d220427',
#       '0x0000000000000000000000005562303c3ae2751773edd248d3cbdc447ed8d82a',
#       '0x000000000000000000000000581bef12967f06f2ebfcabb7504fa61f0326cd9a',
#       '0x0000000000000000000000005fb41dbee72536e2761fc474be221a06dbd7d812',
#       '0x00000000000000000000000062180042606624f02d8a130da8a3171e9b33894d',
#       '0x0000000000000000000000002db7bbeea47f36a70233eabed6162d016477a5a6',
#       '0x000000000000000000000000765e406eb1bb0909f4eae2fe5b52c21c9e61b498',
#       '0x000000000000000000000000802debc52e025461a592069f05a3df386ee67187',
#       '0x0000000000000000000000001cc1c5f71fe7c1a135cc060e17493bafcaff2b45',
#       '0x0000000000000000000000008ae207edd3738f3d6130f2a6255720c765c5c6b6',
#       '0x000000000000000000000000945501737c6060b5e4237b3c2d7e863be3038a81',
#       '0x000000000000000000000000b55d9b50ac5748bd9377757a0c6d463c771ca813',
#       '0x000000000000000000000000d06608313ea30aff0c89a1b3617bce50765e5ca4',
#       '0x000000000000000000000000d8856cce3f878d3ea03964f80b18987ff1919272',
#       '0x000000000000000000000000f5b96fc090a491c861c601f2b051fae552194aa3',
#       '0x000000000000000000000000f76e2d2bba0292cf88f71934aff52ea54baa64d9',
#       '0x000000000000000000000000fd64e8e4e7ddec10fd7b1667f3409307dcb5d1c0'
#     ]
#   ]
# }
# {
# 1155 TransferSingle From
#   topics: [
#     '0xc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62',
#     [
#       '0x00000000000000000000000018ccc241cce98a67564e367ebc1f1f0e692e3188',
#       '0x0000000000000000000000001ccb2945f1325e061b40fe5b0b452f0e76fb7278',
#       '0x000000000000000000000000264bf51639f5753f05d65e4637ad22078f1652ca',
#       '0x0000000000000000000000002eff303377b9e01e042b7f80fb42836b35fb1a49',
#       '0x000000000000000000000000348ee4ed9363299832c33dbb1b52c7fbd5571754',
#       '0x00000000000000000000000039e856863e5f6f0654a0b87b12bc921da23d06bb',
#       '0x0000000000000000000000004e84e4b6ed03c95def00d43e13ff1e8f4d220427',
#       '0x0000000000000000000000005562303c3ae2751773edd248d3cbdc447ed8d82a',
#       '0x000000000000000000000000581bef12967f06f2ebfcabb7504fa61f0326cd9a',
#       '0x0000000000000000000000005fb41dbee72536e2761fc474be221a06dbd7d812',
#       '0x00000000000000000000000062180042606624f02d8a130da8a3171e9b33894d',
#       '0x0000000000000000000000002db7bbeea47f36a70233eabed6162d016477a5a6',
#       '0x000000000000000000000000765e406eb1bb0909f4eae2fe5b52c21c9e61b498',
#       '0x000000000000000000000000802debc52e025461a592069f05a3df386ee67187',
#       '0x0000000000000000000000001cc1c5f71fe7c1a135cc060e17493bafcaff2b45',
#       '0x0000000000000000000000008ae207edd3738f3d6130f2a6255720c765c5c6b6',
#       '0x000000000000000000000000945501737c6060b5e4237b3c2d7e863be3038a81',
#       '0x000000000000000000000000b55d9b50ac5748bd9377757a0c6d463c771ca813',
#       '0x000000000000000000000000d06608313ea30aff0c89a1b3617bce50765e5ca4',
#       '0x000000000000000000000000d8856cce3f878d3ea03964f80b18987ff1919272',
#       '0x000000000000000000000000f5b96fc090a491c861c601f2b051fae552194aa3',
#       '0x000000000000000000000000f76e2d2bba0292cf88f71934aff52ea54baa64d9',
#       '0x000000000000000000000000fd64e8e4e7ddec10fd7b1667f3409307dcb5d1c0'
#     ]
#   ]
# }
# {
#   topics: [
#     '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef',
#     null,
#     [
#       '0x00000000000000000000000018ccc241cce98a67564e367ebc1f1f0e692e3188',
#       '0x0000000000000000000000001ccb2945f1325e061b40fe5b0b452f0e76fb7278',
#       '0x000000000000000000000000264bf51639f5753f05d65e4637ad22078f1652ca',
#       '0x0000000000000000000000002eff303377b9e01e042b7f80fb42836b35fb1a49',
#       '0x000000000000000000000000348ee4ed9363299832c33dbb1b52c7fbd5571754',
#       '0x00000000000000000000000039e856863e5f6f0654a0b87b12bc921da23d06bb',
#       '0x0000000000000000000000004e84e4b6ed03c95def00d43e13ff1e8f4d220427',
#       '0x0000000000000000000000005562303c3ae2751773edd248d3cbdc447ed8d82a',
#       '0x000000000000000000000000581bef12967f06f2ebfcabb7504fa61f0326cd9a',
#       '0x0000000000000000000000005fb41dbee72536e2761fc474be221a06dbd7d812',
#       '0x00000000000000000000000062180042606624f02d8a130da8a3171e9b33894d',
#       '0x0000000000000000000000002db7bbeea47f36a70233eabed6162d016477a5a6',
#       '0x000000000000000000000000765e406eb1bb0909f4eae2fe5b52c21c9e61b498',
#       '0x000000000000000000000000802debc52e025461a592069f05a3df386ee67187',
#       '0x0000000000000000000000001cc1c5f71fe7c1a135cc060e17493bafcaff2b45',
#       '0x0000000000000000000000008ae207edd3738f3d6130f2a6255720c765c5c6b6',
#       '0x000000000000000000000000945501737c6060b5e4237b3c2d7e863be3038a81',
#       '0x000000000000000000000000b55d9b50ac5748bd9377757a0c6d463c771ca813',
#       '0x000000000000000000000000d06608313ea30aff0c89a1b3617bce50765e5ca4',
#       '0x000000000000000000000000d8856cce3f878d3ea03964f80b18987ff1919272',
#       '0x000000000000000000000000f5b96fc090a491c861c601f2b051fae552194aa3',
#       '0x000000000000000000000000f76e2d2bba0292cf88f71934aff52ea54baa64d9',
#       '0x000000000000000000000000fd64e8e4e7ddec10fd7b1667f3409307dcb5d1c0'
#     ]
#   ]
# }
# {
#   1155 TransferSingle To
#   topics: [
#     '0xc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62',
#     null,
#     [
#       '0x00000000000000000000000018ccc241cce98a67564e367ebc1f1f0e692e3188',
#       '0x0000000000000000000000001ccb2945f1325e061b40fe5b0b452f0e76fb7278',
#       '0x000000000000000000000000264bf51639f5753f05d65e4637ad22078f1652ca',
#       '0x0000000000000000000000002eff303377b9e01e042b7f80fb42836b35fb1a49',
#       '0x000000000000000000000000348ee4ed9363299832c33dbb1b52c7fbd5571754',
#       '0x00000000000000000000000039e856863e5f6f0654a0b87b12bc921da23d06bb',
#       '0x0000000000000000000000004e84e4b6ed03c95def00d43e13ff1e8f4d220427',
#       '0x0000000000000000000000005562303c3ae2751773edd248d3cbdc447ed8d82a',
#       '0x000000000000000000000000581bef12967f06f2ebfcabb7504fa61f0326cd9a',
#       '0x0000000000000000000000005fb41dbee72536e2761fc474be221a06dbd7d812',
#       '0x00000000000000000000000062180042606624f02d8a130da8a3171e9b33894d',
#       '0x0000000000000000000000002db7bbeea47f36a70233eabed6162d016477a5a6',
#       '0x000000000000000000000000765e406eb1bb0909f4eae2fe5b52c21c9e61b498',
#       '0x000000000000000000000000802debc52e025461a592069f05a3df386ee67187',
#       '0x0000000000000000000000001cc1c5f71fe7c1a135cc060e17493bafcaff2b45',
#       '0x0000000000000000000000008ae207edd3738f3d6130f2a6255720c765c5c6b6',
#       '0x000000000000000000000000945501737c6060b5e4237b3c2d7e863be3038a81',
#       '0x000000000000000000000000b55d9b50ac5748bd9377757a0c6d463c771ca813',
#       '0x000000000000000000000000d06608313ea30aff0c89a1b3617bce50765e5ca4',
#       '0x000000000000000000000000d8856cce3f878d3ea03964f80b18987ff1919272',
#       '0x000000000000000000000000f5b96fc090a491c861c601f2b051fae552194aa3',
#       '0x000000000000000000000000f76e2d2bba0292cf88f71934aff52ea54baa64d9',
#       '0x000000000000000000000000fd64e8e4e7ddec10fd7b1667f3409307dcb5d1c0'
#     ]
#   ]
# }

# Example response
# {
#     "jsonrpc": "2.0",
#     "method": "eth_subscription",
#     "params": {
#         "result": {
#             "address": "0xf2aecee06841f0cc984ab8d7de5b1e9106890fdc",
#             "topics": [
#                 "0xc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62",
#                 "0x0000000000000000000000001e0049783f008a0085193e00003d00cd54003c71",
#                 "0x0000000000000000000000004e4dd1e789caf122f6621d8ca7b0c7677566bf7d",
#                 "0x000000000000000000000000d5b6e0b031a33bae8cee25d0dbd587a49d47e395"
#             ],
#             "data": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001",
#             "blockNumber": "0xef910d",
#             "transactionHash": "0x370c1432d99d83a35de0c99dc0117bed2d9e9af679b25902f69c5f2cf88a046d",
#             "transactionIndex": "0x30",
#             "blockHash": "0xe82335e54abf7f2886b0cfd2840077ffe8679c8b35d57cbff9fb850d5191a2cf",
#             "logIndex": "0x85",
#             "removed": False
#         },
#         "subscription": "0x9b245d25d9a979268ac43b72e5ac6e51"
#     }
# }

import asyncio
import json
import websockets

from web3 import Web3

RPC_URL = "wss://eth-mainnet.g.alchemy.com/v2/7hOvTTdNWW7ngDBuxt0RI4h91giaqhxP"

ERC20_AND_ERC721_TRANSFER = '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef'

mainnet = Web3(Web3.WebsocketProvider(RPC_URL))

# TODO: To get the rest of the of the event topics we just need to run a test on testnet and snag their values
# TODO: Need to track these for every factory
ORGANIZATION_CREATED = '0x39e4fba473bee8eaa003d03e0707c05d0feae5f9b0e3d1f6b8566694c6ffc786'
# TODO: Need to track these for every organization
ORGANIZATION_UPDATED = ''
BADGE_CREATED = ''
BADGE_UPDATED = ''
BADGE_TRANSFER_SINGLE = '0xc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62'

ADDRESSES = [
    '0x18ccc241cce98a67564e367ebc1f1f0e692e3188',
    '0x1ccb2945f1325e061b40fe5b0b452f0e76fb7278',
    '0x264bf51639f5753f05d65e4637ad22078f1652ca',
    '0x2eff303377b9e01e042b7f80fb42836b35fb1a49',
    '0x348ee4ed9363299832c33dbb1b52c7fbd5571754',
    '0x39e856863e5f6f0654a0b87b12bc921da23d06bb',
    '0x4e84e4b6ed03c95def00d43e13ff1e8f4d220427',
    '0x5562303c3ae2751773edd248d3cbdc447ed8d82a',
    '0x581bef12967f06f2ebfcabb7504fa61f0326cd9a',
    '0x5fb41dbee72536e2761fc474be221a06dbd7d812',
    '0x62180042606624f02d8a130da8a3171e9b33894d',
    '0x2db7bbeea47f36a70233eabed6162d016477a5a6',
    '0x765e406eb1bb0909f4eae2fe5b52c21c9e61b498',
    '0x802debc52e025461a592069f05a3df386ee67187',
    '0x1cc1c5f71fe7c1a135cc060e17493bafcaff2b45',
    '0x945501737c6060b5e4237b3c2d7e863be3038a81',
    '0xb55d9b50ac5748bd9377757a0c6d463c771ca813',
    '0xd06608313ea30aff0c89a1b3617bce50765e5ca4',
    '0xd8856cce3f878d3ea03964f80b18987ff1919272',
    '0xf5b96fc090a491c861c601f2b051fae552194aa3',
    '0xf76e2d2bba0292cf88f71934aff52ea54baa64d9',
    '0xfd64e8e4e7ddec10fd7b1667f3409307dcb5d1c0',
]

FACTORIES = [
    "0x3925be5810fe7bf68447caadec079811470c73b0",
]
FACTORY_TOPICS = [
    ORGANIZATION_CREATED,
]


def topic(address):
    return Web3.toHex(Web3.toBytes(hexstr=address).rjust(32, b'\x00'))


async def main():
    print('in main')
    topics = {}

    # connect to mainnet rpc
    async with websockets.connect(RPC_URL) as ws:

        # start listening for OrganizationCreated events from the Factory
        for topic in FACTORY_TOPICS:
            topics['topics'] = [topic]

            for address in FACTORIES:
                topics['address'] = CONTRACT_ADDRESS

                print(topics)

                # only listen to events from the contract we care about
                await ws.send(json.dumps({
                    "jsonrpc": "2.0",
                    "method": "eth_subscribe",
                    "params": ["logs", topics],
                    "id": 1
                }))

                print('sent')

        while True:
            response = await ws.recv()
            print(response)

if __name__ == "__main__":
    asyncio.run(main())
